# AstrBot 回声洞插件

基于 SQLite3 的简单回声洞插件，让用户可以匿名分享和查看消息。

## 功能特性

- 📝 **添加回声洞**：用户可以发布匿名消息到回声洞
- 🔍 **查看回声洞**：通过编号查看指定的回声洞内容
- 🎲 **随机浏览**：随机获取一条回声洞消息
- 📋 **个人记录**：查看自己或他人发布的回声洞列表（支持分页）
- 🔎 **关键词搜索**：通过关键词搜索回声洞内容
- 🗑️ **删除管理**：创建者和管理员可以删除回声洞
- 📊 **查看统计**：显示回声洞被查看的次数

## 安装方法

1. 将插件文件夹放入 AstrBot 的 `data/plugins/` 目录
2. 重启 AstrBot 或使用热重载功能
3. 在 WebUI 中配置插件参数（可选）

## 使用指南

### 基础命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/ca <内容>` | 添加回声洞 | `/ca 今天天气真好` |
| `/ci <编号>` | 查看指定编号的回声洞 | `/ci 123` |
| `/cq` | 随机查看一条回声洞 | `/cq` |
| `/mycave` | 查看自己的回声洞列表 | `/mycave` |
| `/mycave <页码>` | 查看自己的指定页 | `/mycave 2` |
| `/mycave <QQ号>` | 查看指定QQ的回声洞 | `/mycave 123456789` |
| `/mycave <QQ号> <页码>` | 查看指定QQ的指定页 | `/mycave 123456789 2` |
| `/rmcave <编号>` | 删除指定回声洞 | `/rmcave 123` |
| `/cf <关键词>` | 搜索包含关键词的回声洞 | `/cf 天气` |

### 参数说明

#### mycave 命令规则

- 不输入参数：查看自己的第1页
- 一个参数 < 10000：视为页码，查看自己的指定页
- 一个参数 ≥ 10000：视为QQ号，查看该QQ的第1页
- 两个参数：第一个为QQ号，第二个为页码

## 配置说明

插件支持在 WebUI 中进行可视化配置，主要配置项包括：

### 基础配置

- **super_admins**：超级管理员QQ列表，可以删除任何回声洞
- **max_content_length**：回声洞内容最大长度（默认：200字）
- **page_size**：每页显示的回声洞数量（默认：100条）

### 个性化配置

- **quotes**：添加回声洞成功后随机显示的名言列表
- **messages**：自定义各种提示消息文案

### 消息文案配置

所有提示消息都可以在配置文件中自定义，包括：

- 空内容提示
- 无效回声洞提示
- 已删除回声洞提示
- 权限不足提示
- 搜索结果提示
- 等等...

支持使用占位符，如 `{cave_id}`、`{qq}`、`{page}` 等。

## 权限说明

### 删除权限

只有以下用户可以删除回声洞：

1. 回声洞的创建者本人
2. 配置中设置的超级管理员

### 查看权限

所有用户都可以：

- 查看任何未删除的回声洞
- 查看任何用户的回声洞列表
- 搜索回声洞内容

## 数据存储

- 数据库类型：SQLite3
- 存储位置：`data/plugin_data/astrbot_plugin_cave/cave.db`
- 数据表结构：
  - `cave_id`：回声洞编号（自增主键）
  - `text`：回声洞内容
  - `sender_id`：发送者QQ号
  - `group_id`：群号（私聊为0）
  - `group_nick`：群名称
  - `pick_count`：查看次数
  - `date`：创建时间戳
  - `is_deleted`：删除标记（0=未删除，1=已删除）

## 技术特性

- ✅ 软删除机制，数据可追溯
- ✅ SQL层分页和限制，优化性能
- ✅ 完善的错误处理和日志记录
- ✅ 支持合并消息转发（搜索结果）
- ✅ 自动降级策略（转发失败时逐条发送）
- ✅ 所有文案可配置化

## 兼容性

- **测试环境**：AstrBot 4.15.0 + NapCat 个人号
- **推荐版本**：AstrBot >= 4.11
- **平台支持**：仅支持 aiocqhttp 平台（NapCat）

## 注意事项

1. 本插件仅提供技术实现，使用者需自行为回声洞中的所有信息负责
2. 建议设置合理的内容长度限制，避免消息过长
3. 超级管理员权限较高，请谨慎配置
4. 删除操作为软删除，数据库中仍保留记录
5. 搜索结果最多返回配置的 `page_size` 条记录

## 更新日志

详见 [CHANGELOG.md](CHANGELOG.md)

## 作者

- **作者**：lingyu
- **版本**：2.0.0

## 许可证

本插件遵循 AstrBot 插件开发规范，使用者需遵守相关法律法规。

## 反馈与支持

如遇到问题或有功能建议，欢迎提交 Issue。

---

**免责声明**：本插件仅提供技术实现，使用者需自行为回声洞中发布的所有内容负责。请遵守相关法律法规，文明使用。
